- name: Verificar y arrancar servicios CyberPanel
  block:
    - name: Comprobar estado del servicio "{{ item }}"
      systemd:
        name: "{{ item }}"
        state: started
      register: service_result
      ignore_errors: true
      loop: "{{ cyberpanel_services }}"
      loop_control:
        label: "{{ item }}"

    - name: Mostrar resultado de "{{ item }}"
      debug:
        msg: >-
          Servicio {{ item }}:
          Estado antes: {{ service_result.results[loop.index0].status }}
          Cambio realizado: {{ service_result.results[loop.index0].changed }}
  rescue:
    - name: Error gestionando servicio "{{ item }}"
      debug:
        msg: "⚠️ No se pudo iniciar o verificar el servicio {{ item }}. Revisa manualmente."
